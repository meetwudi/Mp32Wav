package org.mp3transform.test;

import org.mp3transform.alarm.Scheduler;

public class TestScheduler {
    
    public static void main(String[] a) throws Exception {
        // Every minute
        check("* * * * *", "08-01-01 00:00; 08-01-01 00:01; 08-01-01 00:02; 08-01-01 00:03; 08-01-01 00:04");
        // Every hour
        check("0 * * * *", "08-01-01 00:00; 08-01-01 01:00; 08-01-01 02:00; 08-01-01 03:00; 08-01-01 04:00");
        // One past two
        check("1 2 * * *", "08-01-01 02:01; 08-01-02 02:01; 08-01-03 02:01; 08-01-04 02:01; 08-01-05 02:01");
        // Every 31th
        check("7 8 31 * *", "08-01-31 08:07; 08-03-31 08:07; 08-05-31 08:07; 08-07-31 08:07; 08-08-31 08:07");
        // One o'clock
        check("0 1,13 * * *", "08-01-01 01:00; 08-01-01 13:00; 08-01-02 01:00; 08-01-02 13:00; 08-01-03 01:00");
        // 6 am, every 20 minutes
        check("*/20 6 * * *", "08-01-01 06:00; 08-01-01 06:20; 08-01-01 06:40; 08-01-02 06:00; 08-01-02 06:20");
        // Every two hours
        check("00 */2 * * *", "08-01-01 00:00; 08-01-01 02:00; 08-01-01 04:00; 08-01-01 06:00; 08-01-01 08:00");
        // One thirty and two thirty
        check("30 1,2 * * *", "08-01-01 01:30; 08-01-01 02:30; 08-01-02 01:30; 08-01-02 02:30; 08-01-03 01:30");
        // 3 times at 2 pm
        check("1-3 14 * * *", "08-01-01 14:01; 08-01-01 14:02; 08-01-01 14:03; 08-01-02 14:01; 08-01-02 14:02");
        // Every Sunday at 11
        check("0 11 * * 0", "08-01-06 11:00; 08-01-13 11:00; 08-01-20 11:00; 08-01-27 11:00; 08-02-03 11:00");
        // Every Sunday at 12
        check("0 11 * * 0", "08-01-06 11:00; 08-01-13 11:00; 08-01-20 11:00; 08-01-27 11:00; 08-02-03 11:00");
        // February; every Monday and 29th
        check("0 12 29 2 1", "08-02-04 12:00; 08-02-11 12:00; 08-02-18 12:00; 08-02-25 12:00; 08-02-29 12:00");
        // 1st and 2nd of each month, as well as every Monday at midnight
        check("0 0 1,2 * 1", "08-01-01 00:00; 08-01-02 00:00; 08-01-07 00:00; 08-01-14 00:00; 08-01-21 00:00");
        // check ranges
        check("0-59 0-23 1-31 1-12 0-7", "08-01-01 00:00; 08-01-01 00:01; 08-01-01 00:02; 08-01-01 00:03; 08-01-01 00:04");
        // ranges
        check("0-59 0-23 1-31 1-12 0-7", "08-01-01 00:00; 08-01-01 00:01; 08-01-01 00:02; 08-01-01 00:03; 08-01-01 00:04");
        // lists of ranges
        check("0 0-1,3,5-5 * * *", "08-01-01 00:00; 08-01-01 01:00; 08-01-01 03:00; 08-01-01 05:00; 08-01-02 00:00");
        // steps
        check("0 0-4/2 * * *", "08-01-01 00:00; 08-01-01 02:00; 08-01-01 04:00; 08-01-02 00:00; 08-01-02 02:00");
        // steps
        check("0 0-4/2,1 * * *", "08-01-01 00:00; 08-01-01 01:00; 08-01-01 02:00; 08-01-01 04:00; 08-01-02 00:00");
    }

    static void check(String when, String expected) {
        Scheduler s = Scheduler.getInstance();
        String x = s.createJob(when, null).getSamples(5);
        if (!expected.equals(x)) {
            throw new Error("mismatch with " + when + "; expected:\n" + expected + "\n" + x);
        }
    }

}
